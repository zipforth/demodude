<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="style.css">
<script>
var down = [140];
var timers = [];
var timersize = 0;
down[37]=false;
down[38]=false;
down[39]=false;
down[40]=false;
down[32]=false;



function leftArrowPressed() {
        var element = document.getElementById("red1");
        if(parseInt(element.style.left)>35 && checkRight(parseInt(element.style.top)+50,parseInt(element.style.left)))
        {
		element.style.left = parseInt(element.style.left) - 10 + 'px';
      	}
}

      function rightArrowPressed() {
        var element = document.getElementById("red1");
        if(parseInt(element.style.left)<670 && checkRight(parseInt(element.style.top)+50,parseInt(element.style.left)+50))
	{
		element.style.left = parseInt(element.style.left) + 10 + 'px';
        }	
      }

      function upArrowPressed() {
        var element = document.getElementById("red1");
        if(parseInt(element.style.top)>20 && checkRight(parseInt(element.style.top)+10,parseInt(element.style.left)+30))
        {
		element.style.top = parseInt(element.style.top) - 10 + 'px';
      	}
	}

      function downArrowPressed() {
        var element = document.getElementById("red1");
        if(parseInt(element.style.top)<420 && checkRight(parseInt(element.style.top)+65,parseInt(element.style.left)+30))
        {
		element.style.top = parseInt(element.style.top) + 10 + 'px';
      	}
	}
      function spacePressed(){
//	var element = document.getElementById("bomb1");
	var element = new Image(40,40);
	element.src = "./assets/bomb1.png";
        element.style.position = "absolute";
	var element2 = document.getElementById("red1");
        element.style.top = parseInt(element2.style.top) +20+ 'px';
        element.style.left = parseInt(element2.style.left) +10+ 'px';
	var units = [20, parseInt(element.style.top),parseInt(element.style.left)];
	timers.push(units);
	timersize++;
	console.log(element.style.top);
	console.log(element.style.left);
	document.getElementById("gamescreen").appendChild(element);
      }
	function checkRight(t,l)
	{
		let els=document.elementsFromPoint(l,t);
		for(var i = 0; i< els.length; i++)
		{
			var el = els[i];
			if (typeof el.src === "undefined")
			{
				
			}
			else
			{
				if (el.src.includes("breaker") || el.src.includes("bomb")|| el.src.includes("blocker"))
				{
					console.log(el.src);
					return false;
				}
			}
		}
		return true;
	}

      function moveSelection() {
        if(down[32])
	{
		spacePressed();
		down[32]=false;
	}  
        if(down[37])
	{
		leftArrowPressed();
	}  
        if(down[38])
	{
		upArrowPressed();
	}  
        if(down[39])
	{
		rightArrowPressed();
	}  
        if(down[40])
	{
		downArrowPressed();
	}
	var dec=0;
	console.log(timers);
	for( let i = timersize-1; i >=0 ; i--)
	{
		if(timers[i][0]==0)
		{
			console.log("boom");
			timersize--;
			let els=document.elementsFromPoint(timers[i][2],timers[i][1]);
			for(var j = 0; j< els.length; j++)
			{
				var el = els[j];
				if (typeof el.src === "undefined")
				{
					
				}
				else
				{
					if (el.src.includes("bomb"))
					{
						el.parentNode.removeChild(el);
					}
				}
			}
			timers.splice(i,1);
		}
		else
		{
			console.log(timers[i][0]);
			timers[i][0]--;
		}
	}
      };
	setInterval(moveSelection,100);
	document.onkeydown=e => {
		if( !down[e.keyCode]){
			down[e.keyCode] = true;
			for (let i = 37; i <=40 ; i++)
			{
				if( i != e.keyCode && e.keyCode != 32)
				{
					down[i]=false;
				}

			} 
		}
	};
	document.onkeyup=e => (down[e.keyCode] = false);
	
</script>
</head>
<body id="gamescreen">
<img class="overlayImage" src="./assets/board1.png" id="board1">
<img class="overlayImage" src="./assets/floor1.png" id="floor1">
<script>
	function placeBreaker(x,y)
	{
		var element = new Image(40,40);
		element.src = "./assets/breaker1.png";
        	element.style.position = "absolute";
		//element.style.zIndex = "1";
        	element.style.top = y+ 'px';
        	element.style.left = x+ 'px';
		document.getElementById("gamescreen").appendChild(element);
	}
	function placeBlocker(x,y)
	{
		var element = new Image(40,40);
		element.src = "./assets/blocker1.png";
        	element.style.position = "absolute";
		//element.style.zIndex = "1";
        	element.style.top = y+ 'px';
        	element.style.left = x+ 'px';
		document.getElementById("gamescreen").appendChild(element);
	}
	for ( let i = 40 ; i<=680 ; i+=40)
	{
		for ( let j = 80 ; j<=400 ; j+=40)
		{
			if( i%80 != 0 || j%80 != 0)
			{
				if( (Math.floor(Math.random()*100))%4 ==0)
				{
					placeBreaker(i,j);
				}
			}
			else
			{
				placeBlocker(i,j);
			}
		}
	}

	
</script>
<img class="overlayImage" src="./assets/red1.png" style="position:absolute;top:0;left:0;" id="red1">
<script>

	var player = document.getElementById("red1");
        player.style.top = 20+ 'px';
        player.style.left = 30+ 'px';
//	player.style.zIndex = "2";	
</script>
</body>
</html>

